#!/bin/sh
#
# Usage: driver_tex [d1 d2 ...]
#

# if there was no argument given to the script, default to creating
# the manual for all subdirectories listed in the file "docdirs"
# otherwise use only those subdirectories given as arguments
if [ $# -ne 0 ] ; then
   DIRS="$*"
elif [ -f docdirs ] ; then
   DIRS=`cat docdirs`
else
   DIRS=""
fi

for DIR in $DIRS ; do
  echo "***********"
  echo "Starting with directory $DIR..."
  echo
  cd $DIR
  echo "Now in directory $DIR..."
  echo
  echo "  ...$DIR's first LaTeX pass"
  echo
  to_dvi 

  echo
  echo "  ...$DIR's bibtex "
  echo
  bibtex wrapper

  # add table of contents line for bibliography
  if [ -f wrapper.bbl ]; then
     sed 's/\\begin{thebibliography}{.*}/&\\addcontentsline{toc}{chapter}{Bibliography}/' wrapper.bbl > new_wrapper.bbl
     \mv new_wrapper.bbl wrapper.bbl
  fi

  echo 
  echo "  ...$DIR's second LaTeX pass "
  echo
  to_dvi 
  echo 
  echo "  ...$DIR's third LaTeX pass "
  echo 
  to_dvi 
     
  if [ -f wrapper.idx ]; then
     echo 
     echo "  ...making $DIR's index"
     echo 
     makeindex wrapper
     index_fix wrapper.ind
  fi

  if [ -f wrapper.ref ]; then
      echo
      echo " ... sorting reference pages "
      echo
      sort -f +2 -3 wrapper.ref > wrapper.ref_sorted
      cp wrapper.ref_sorted wrapper.ref
  fi

  echo 
  echo "  ... $DIR's final LaTeX pass"
  echo 
  to_dvi 
  echo 
  echo "  ... creating $DIR's postscript"
  echo 
  to_postscript 
  to_postscript_letter

  echo
  echo "DONE with directory $DIR"
  echo "****************"
done
